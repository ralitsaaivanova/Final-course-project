<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Register</title>
    <script>
        function onRoleChange() {
            const role = document.getElementById('role').value;
            // hide all extras
            document.querySelectorAll('.extra-field').forEach(el => el.style.display='none');

            // show only the fields for the selected role
            if (role === 'ROLE_CLIENT') {
                document.getElementById('client-fields').style.display='block';
            } else if (role === 'ROLE_OPERATOR') {
                document.getElementById('operator-fields').style.display='block';
            } else if (role === 'ROLE_AGENT') {
                document.getElementById('agent-fields').style.display='block';
            }
        }
        document.addEventListener('DOMContentLoaded', () => {
            onRoleChange();
            document.getElementById('role').addEventListener('change', onRoleChange);
        });
    </script>
</head>
<body>
<h1>Register</h1>

<div th:if="${#fields.hasGlobalErrors()}">
    <p th:each="err : ${#fields.globalErrors()}"
       th:text="${err}">Error</p>
</div>

<form th:action="@{/users/register}" th:object="${form}" method="post">

    <label>Email</label>
    <input type="email" th:field="*{email}" />
    <div th:if="${#fields.hasErrors('email')}"
         th:errors="*{email}">Email error</div>

    <label>Password</label>
    <input type="password" th:field="*{password}" />
    <div th:if="${#fields.hasErrors('password')}"
         th:errors="*{password}">Password error</div>

    <label>Role</label>
    <select id="role" th:field="*{role}">
        <option th:each="r : ${roles}" th:value="${r}" th:text="${r}">ROLE</option>
    </select>
    <div th:if="${#fields.hasErrors('role')}"
         th:errors="*{role}">Role error</div>

    <!-- CLIENT fields -->
    <div id="client-fields" class="extra-field">
        <h3>Client Info</h3>
        <label>Name</label>
        <input type="text" th:field="*{name}" />
        <div th:if="${#fields.hasErrors('name')}"
             th:errors="*{name}">Name error</div>

        <label>Phone</label>
        <input type="text" th:field="*{phone}" />
        <div th:if="${#fields.hasErrors('phone')}"
             th:errors="*{phone}">Phone error</div>
    </div>

    <!-- OPERATOR fields -->
    <div id="operator-fields" class="extra-field">
        <h3>Operator Info</h3>
        <label>Name</label>
        <input type="text" th:field="*{name}" />
        <div th:if="${#fields.hasErrors('name')}"
             th:errors="*{name}">Name error</div>

        <label>Phone</label>
        <input type="text" th:field="*{phone}" />
        <div th:if="${#fields.hasErrors('phone')}"
             th:errors="*{phone}">Phone error</div>

        <label>Address</label>
        <input type="text" th:field="*{address}" />
        <div th:if="${#fields.hasErrors('address')}"
             th:errors="*{address}">Address error</div>
    </div>

    <!-- AGENT fields -->
    <div id="agent-fields" class="extra-field">
        <h3>Agent Info</h3>
        <label>Name</label>
        <input type="text" th:field="*{name}" />
        <div th:if="${#fields.hasErrors('name')}"
             th:errors="*{name}">Name error</div>

        <label>Commission %</label>
        <input type="number" step="0.01" th:field="*{commissionPercent}" />
        <div th:if="${#fields.hasErrors('commissionPercent')}"
             th:errors="*{commissionPercent}">Commission error</div>
    </div>

    <button type="submit">Register</button>
</form>
</body>
</html>